<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Chamado - Sistema SUS</title>
    <link rel="stylesheet" href="/css/global.css">
</head>
<body>
    <div class="navbar">
        <a href="/">Cadastrar Paciente</a>
        <a href="/pacientes/lista">Listar Pacientes</a>
        <a href="/chamados/cadastro">Registrar Chamado</a>
        <a href="/chamados/lista">Listar Chamados</a>
        </div>
    <div class="container">
        <h2>Detalhes do Chamado</h2>
        <div id="loading" class="loading-message">Carregando detalhes do chamado...</div>
        <div id="notFound" class="not-found-message" style="display: none;">Chamado não encontrado.</div>
        <div id="errorMessage" class="error-message" style="display: none;">Erro ao carregar os detalhes do chamado.</div>

        <div id="chamadoDetails" style="display: none;">
            <h3 class="section-title">Dados do Chamado</h3>
            <div class="details-grid">
                <label>ID do Chamado:</label><span id="chamadoIdDisplay"></span>
                <label>Data/Hora:</label><span id="dataHoraChamado"></span>
                <label>Status:</label><span id="statusChamado"></span>
                <label>Sintomas Principais:</label><span id="sintomasChamado"></span>
                <label>Observações Adicionais:</label><span id="observacoesAdicionaisChamado"></span>
            </div>

            <h3 class="section-title">Dados do Paciente</h3>
            <div class="details-grid">
                <label>ID do Paciente:</label><span id="pacienteId"></span>
                <label>Nome do Paciente:</label><span id="nomePaciente"></span>
                <label>CPF do Paciente:</label><span id="cpfPaciente"></span>
                <label>Telefone do Paciente:</label><span id="telefonePaciente"></span>
            </div>

            <h3 class="section-title">Endereço de Atendimento</h3>
            <div class="details-grid">
                <label>Logradouro:</label><span id="logradouroAtendimento"></span>
                <label>Número:</label><span id="numeroAtendimento"></span>
                <label>Complemento:</label><span id="complementoAtendimento"></span>
                <label>Bairro:</label><span id="bairroAtendimento"></span>
                <label>Cidade:</label><span id="cidadeAtendimento"></span>
                <label>Estado (UF):</label><span id="estadoAtendimento"></span>
                <label>CEP:</label><span id="cepAtendimento"></span>
                <label>País:</label><span id="paisAtendimento"></span>
            </div>
        </div>

        <div class="back-button">
            <a href="/chamados/lista">Voltar para a Lista de Chamados</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chamadoDetailsDiv = document.getElementById('chamadoDetails');
            const loadingMessage = document.getElementById('loading');
            const notFoundMessage = document.getElementById('notFound');
            const errorMessage = document.getElementById('errorMessage');

            // Captura o ID do chamado da URL
            const pathSegments = window.location.pathname.split('/');
            const chamadoId = pathSegments[pathSegments.length - 2]; 

            if (!chamadoId) {
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'ID do chamado não fornecido na URL.';
                return;
            }

            fetch(`/chamados/${chamadoId}`, { 
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                loadingMessage.style.display = 'none'; 
                if (response.status === 404) {
                    notFoundMessage.style.display = 'block';
                    throw new Error('Chamado não encontrado');
                }
                if (!response.ok) {
                    throw new Error('Erro na rede ou servidor respondeu com erro.');
                }
                return response.json();
            })
            .then(chamado => {
                chamadoDetailsDiv.style.display = 'block'; 

                document.getElementById('chamadoIdDisplay').textContent = chamado.id || 'N/A';
                document.getElementById('dataHoraChamado').textContent = chamado.dataHoraChamado ? new Date(chamado.dataHoraChamado).toLocaleString('pt-BR') : 'N/A';
                document.getElementById('statusChamado').textContent = chamado.status || 'N/A';
                document.getElementById('sintomasChamado').textContent = chamado.sintomas || 'N/A';
                document.getElementById('observacoesAdicionaisChamado').textContent = chamado.observacoesAdicionais || 'Nenhuma';

                if (chamado.paciente) {
                    document.getElementById('pacienteId').textContent = chamado.paciente.id || 'N/A';
                    document.getElementById('nomePaciente').textContent = chamado.paciente.nome || 'N/A';
                    document.getElementById('cpfPaciente').textContent = chamado.paciente.cpf || 'N/A';
                    document.getElementById('telefonePaciente').textContent = chamado.paciente.telefoneContato || 'N/A';
                } else {
                    document.getElementById('pacienteId').textContent = 'N/A';
                    document.getElementById('nomePaciente').textContent = 'N/A';
                    document.getElementById('cpfPaciente').textContent = 'N/A';
                    document.getElementById('telefonePaciente').textContent = 'N/A';
                }

                if (chamado.enderecoAtendimento) {
                    const endereco = chamado.enderecoAtendimento;
                    document.getElementById('logradouroAtendimento').textContent = endereco.logradouro || 'N/A';
                    document.getElementById('numeroAtendimento').textContent = endereco.numero || 'N/A';
                    document.getElementById('complementoAtendimento').textContent = endereco.complemento || 'N/A';
                    document.getElementById('bairroAtendimento').textContent = endereco.bairro || 'N/A';
                    document.getElementById('cidadeAtendimento').textContent = endereco.cidade || 'N/A';
                    document.getElementById('estadoAtendimento').textContent = endereco.estado || 'N/A';
                    document.getElementById('cepAtendimento').textContent = endereco.cep || 'N/A';
                    document.getElementById('paisAtendimento').textContent = endereco.pais || 'N/A';
                } else {
                    document.getElementById('logradouroAtendimento').textContent = 'N/A';
                    document.getElementById('numeroAtendimento').textContent = 'N/A';
                    document.getElementById('complementoAtendimento').textContent = 'N/A';
                    document.getElementById('bairroAtendimento').textContent = 'N/A';
                    document.getElementById('cidadeAtendimento').textContent = 'N/A';
                    document.getElementById('estadoAtendimento').textContent = 'N/A';
                    document.getElementById('cepAtendimento').textContent = 'N/A';
                    document.getElementById('paisAtendimento').textContent = 'N/A';
                }
            })
            .catch(error => {
                console.error('Erro ao buscar detalhes do chamado:', error);
                if (error.message !== 'Chamado não encontrado') {
                    errorMessage.style.display = 'block';
                }
            });
        });

        
    </script>
</body>
</html>