<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Paciente - Sistema SUS</title>
    <link rel="stylesheet" href="/css/global.css">

</head>
<body>
    <div class="navbar">
        <a href="/">Cadastrar Paciente</a>
        <a href="/pacientes/lista">Listar Pacientes</a>
        <a href="/chamados/cadastro">Registrar Chamado</a>
        <a href="/chamados/lista">Listar Chamados</a>
        </div>
    <div class="container">
        <h2>Detalhes do Paciente</h2>
        <div id="loading" class="loading-message">Carregando detalhes do paciente...</div>
        <div id="notFound" class="not-found-message" style="display: none;">Paciente não encontrado.</div>
        <div id="errorMessage" class="error-message" style="display: none;">Erro ao carregar os detalhes do paciente.</div>

        <div id="pacienteDetails" style="display: none;">
            <h3 class="section-title">Dados Pessoais</h3>
            <div class="details-grid">
                <label>ID:</label><span id="pacienteIdDisplay"></span>
                <label>Nome Completo:</label><span id="nomePaciente"></span>
                <label>CPF:</label><span id="cpfPaciente"></span>
                <label>Data de Nascimento:</label><span id="dataNascimentoPaciente"></span>
                <label>Telefone de Contato:</label><span id="telefonePaciente"></span>
                <label>E-mail de Contato:</label><span id="emailPaciente"></span>
            </div>

            <h3 class="section-title">Endereço</h3>
            <div class="details-grid">
                <label>Logradouro:</label><span id="logradouroPaciente"></span>
                <label>Número:</label><span id="numeroPaciente"></span>
                <label>Complemento:</label><span id="complementoPaciente"></span>
                <label>Bairro:</label><span id="bairroPaciente"></span>
                <label>Cidade:</label><span id="cidadePaciente"></span>
                <label>Estado:</label><span id="estadoPaciente"></span>
                <label>CEP:</label><span id="cepPaciente"></span>
                <label>País:</label><span id="paisPaciente"></span>
            </div>

            <h3 class="section-title">Informações de Deficiência</h3>
            <div class="details-grid">
                <label>Possui Deficiência?</label><span id="possuiDeficienciaPaciente"></span>
                <label id="labelTipoDeficiencia" style="display: none;">Tipo de Deficiência:</label><span id="tipoDeficienciaPaciente" style="display: none;"></span>
                <label id="labelObsDeficiencia" style="display: none;">Observações:</label><span id="observacoesDeficienciaPaciente" style="display: none;"></span>
            </div>
        </div>

        <div class="back-button">
            <a href="/pacientes/lista">Voltar para a Lista de Pacientes</a>
        </div>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const pacienteDetailsDiv = document.getElementById('pacienteDetails');
            const loadingMessage = document.getElementById('loading');
            const notFoundMessage = document.getElementById('notFound');
            const errorMessage = document.getElementById('errorMessage');


            const pathSegments = window.location.pathname.split('/');
            const pacienteId = pathSegments[pathSegments.length - 2]; 

            if (!pacienteId) {
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'ID do paciente não fornecido na URL.';
                return;
            }

            fetch(`/pacientes/${pacienteId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                loadingMessage.style.display = 'none'; 
                if (response.status === 404) {
                    notFoundMessage.style.display = 'block';
                    throw new Error('Paciente não encontrado');
                }
                if (!response.ok) {
                    throw new Error('Erro na rede ou servidor respondeu com erro.');
                }
                return response.json();
            })
            .then(paciente => {
                pacienteDetailsDiv.style.display = 'block'; 

                document.getElementById('pacienteIdDisplay').textContent = paciente.id;
                document.getElementById('nomePaciente').textContent = paciente.nome;
                document.getElementById('cpfPaciente').textContent = paciente.cpf;
                document.getElementById('dataNascimentoPaciente').textContent = paciente.dataDeNascimento;
                document.getElementById('telefonePaciente').textContent = paciente.telefoneContato;
                document.getElementById('emailPaciente').textContent = paciente.emailContato;

                // Preencher Endereço
                if (paciente.endereco) {
                    document.getElementById('logradouroPaciente').textContent = paciente.endereco.logradouro || 'N/A';
                    document.getElementById('numeroPaciente').textContent = paciente.endereco.numero || 'N/A';
                    document.getElementById('complementoPaciente').textContent = paciente.endereco.complemento || 'N/A';
                    document.getElementById('bairroPaciente').textContent = paciente.endereco.bairro || 'N/A';
                    document.getElementById('cidadePaciente').textContent = paciente.endereco.cidade || 'N/A';
                    document.getElementById('estadoPaciente').textContent = paciente.endereco.estado || 'N/A';
                    document.getElementById('cepPaciente').textContent = paciente.endereco.cep || 'N/A';
                    document.getElementById('paisPaciente').textContent = paciente.endereco.pais || 'N/A';
                } else {
                    document.querySelectorAll('.details-grid span').forEach(span => {
                        if (span.id.includes('Paciente')) span.textContent = 'N/A';
                    });
                }

                // Preencher Deficiência
                const possuiDeficienciaSpan = document.getElementById('possuiDeficienciaPaciente');
                const tipoDeficienciaSpan = document.getElementById('tipoDeficienciaPaciente');
                const obsDeficienciaSpan = document.getElementById('observacoesDeficienciaPaciente');
                const labelTipoDeficiencia = document.getElementById('labelTipoDeficiencia');
                const labelObsDeficiencia = document.getElementById('labelObsDeficiencia');

                if (paciente.possuiDeficiencia) {
                    possuiDeficienciaSpan.textContent = 'Sim';
                    tipoDeficienciaSpan.textContent = paciente.tipoDeDeficiencia || 'Não especificado';
                    obsDeficienciaSpan.textContent = paciente.observacoesDeficiencia || 'Nenhuma';
                    labelTipoDeficiencia.style.display = 'block';
                    tipoDeficienciaSpan.style.display = 'block';
                    labelObsDeficiencia.style.display = 'block';
                    obsDeficienciaSpan.style.display = 'block';
                } else {
                    possuiDeficienciaSpan.textContent = 'Não';
                    labelTipoDeficiencia.style.display = 'none';
                    tipoDeficienciaSpan.style.display = 'none';
                    labelObsDeficiencia.style.display = 'none';
                    obsDeficienciaSpan.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Erro ao buscar detalhes do paciente:', error);
                if (error.message !== 'Paciente não encontrado') {
                    errorMessage.style.display = 'block';
                }
            });
        });

        
    </script>
</body>
</html>